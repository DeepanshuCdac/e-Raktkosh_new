# QUERY 2....
query.SELECT_CAMP_DONOR_DETAIL = SELECT hbnum_mobileno from hbbt_portal_campdonor_dtl where hbnum_mobileno=? AND gnum_isvalid=1 limit 1

# QUERY 3...
query.SELECT.DONOR_DETAILS = SELECT initcap(hbstr_fname) AS hbstr_fname,hbstr_lname, hbnum_bldgrp_code,hbdt_lastlogin, hbnum_firstlogin, hbnum_demographics, hbnum_usertype,gnum_portal_donor_id,hbnum_eraktkosh, hbstr_mobile_no, hbstr_email_id,NVL(hbstr_image_string,'transactions/assets/no-image.png') AS hbstr_image_string,hbnum_login_attempt,hbnum_login_attempt_date , hbnum_donor_ref_no , hbstr_health_id, hbstr_password,hbnum_healthid_number,(SELECT INITCAP(C.GSTR_STATE_NAME) FROM GBLT_STATE_MST C WHERE C.GNUM_STATE_CODE = hbbt_portal_donor_dtl.gnum_state_code) as edonorStateName,(SELECT distinct(y.gstr_district_name) FROM gblt_district_mst y WHERE y.gnum_district_code=hbbt_portal_donor_dtl.gnum_district_code and gnum_isvalid=1) as edonorDistName,(SELECT nvl(C.gnum_lgd_state_code,0)FROM GBLT_STATE_MST C WHERE C.GNUM_STATE_CODE  =HBBT_PORTAL_DONOR_DTL.GNUM_STATE_CODE AND GNUM_ISVALID = 1) AS lgd_state_code,(SELECT nvl(Y.gnum_lgd_district_code,0)FROM GBLT_DISTRICT_MST Y	WHERE Y.GNUM_DISTRICT_CODE = HBBT_PORTAL_DONOR_DTL.GNUM_DISTRICT_CODE AND GNUM_ISVALID = 1) AS lgd_district_code FROM hbbt_portal_donor_dtl  WHERE hbstr_userid=? and gnum_isvalid=1 and hbnum_registration_mode=0

# QUERY 4...
query.PREV_DONATION_DETAIL_QUERY = SELECT DISTINCT(BAGNO) AS BAGNO, GDT_ENTRY_DATE, USERNAME, FROMPREVDONATIONTABLE, ORGANIZATIONNAME AS ORGANIZATIONNAME, ORGANIZATIONTYPE AS ORGANIZATIONTYPE, STATENAME AS STATENAME, DISTRICTNAME AS DISTRICTNAME, date, BLOODBANK, GNUM_PORTAL_DONOR_ID, STATE, DISTRICT, HBSTR_DONOR_CONTACT_NO, BLOODGROUPNAME AS BLOODGROUPNAME, DONORTYPE FROM ( (SELECT P.GDT_ENTRY_DATE, NVL((HBSTR_FNAME || ' ' || HBSTR_LNAME)::CHARACTER varying,(SELECT HBSTR_FNAME FROM HBBT_DONOR_DTL X,HBBT_DONOR_VISIT_DTL Y WHERE X.HBNUM_DONOR_REGNO = Y.HBNUM_DONOR_REGNO AND X.GNUM_ISVALID = 1 AND Y.GNUM_ISVALID = 1 AND HBSTR_BLDBAG_NO = P.HBNUM_DONATION_ID LIMIT 1)::CHARACTER varying) AS USERNAME, 1 AS FROMPREVDONATIONTABLE, HBSTR_BB_NAME AS ORGANIZATIONNAME, 'NA' AS ORGANIZATIONTYPE, (SELECT GSTR_STATE_NAME FROM GBLT_STATE_MST X WHERE X.GNUM_STATE_CODE = (SELECT GNUM_STATE_CODE FROM GBLT_HOSPITAL_MST D WHERE D.GNUM_HOSPITAL_CODE = P.GNUM_PORTAL_HOSPITAL_CODE AND D.GNUM_ISVALID = 1 ) AND X.GNUM_ISVALID = 1 ) AS STATENAME , (SELECT GSTR_DISTRICT_NAME FROM GBLT_DISTRICT_MST Y WHERE Y.GNUM_DISTRICT_CODE = (SELECT NUM_DIST_ID FROM GBLT_HOSPITAL_MST D WHERE D.GNUM_HOSPITAL_CODE = P.GNUM_PORTAL_HOSPITAL_CODE AND D.GNUM_ISVALID = 1 ) AND Y.GNUM_ISVALID = 1 LIMIT 1) AS DISTRICTNAME, NVL(TO_CHAR(HBDT_DONATION, 'dd-Mon-yy'), '-') AS date, P.HBSTR_BB_NAME AS BLOODBANK, P.GNUM_PORTAL_DONOR_ID:: CHARACTER varying, HBNUM_DONATION_ID AS BAGNO, (SELECT GNUM_STATE_CODE FROM GBLT_HOSPITAL_MST D WHERE D.GNUM_HOSPITAL_CODE = P.GNUM_PORTAL_HOSPITAL_CODE AND D.GNUM_ISVALID = 1 ) AS STATE , (SELECT D.NUM_DIST_ID FROM GBLT_HOSPITAL_MST D WHERE D.GNUM_HOSPITAL_CODE = P.GNUM_PORTAL_HOSPITAL_CODE AND D.GNUM_ISVALID = 1 LIMIT 1) AS DISTRICT, P.HBSTR_DONOR_CONTACT_NO, NVL(( (SELECT HBSTR_INITIALBLD_ABO || '' || DECODE(HBNUM_INITIAL_RH, 1, '+ve', 2, '-ve') FROM HBBT_DONOR_VISIT_DTL Y WHERE HBSTR_BLDBAG_NO = P.HBNUM_DONATION_ID AND GNUM_ISVALID = 1 LIMIT 1)::CHARACTER varying), (SELECT HBSTR_BLDGRP FROM HBBT_BLDGRP_MST X WHERE X.HBNUM_BLDGRP_CODE = A.HBNUM_BLDGRP_CODE )::CHARACTER VARYING) AS BLOODGROUPNAME, 0 AS DONORTYPE FROM HBBT_PORTAL_DONOR_PREVDONATION_DTL P, HBBT_PORTAL_DONOR_DTL A where ( P.GNUM_PORTAL_DONOR_ID = A. gnum_portal_donor_id ) AND A.hbstr_mobile_no=? and P.gnum_isvalid=1 and A.gnum_isvalid=1 and p.HBNUM_DONATION_ID not in (select HBSTR_BLDBAG_NO from hbbt_donor_visit_dtl v, hbbt_donor_dtl d WHERE d.HBNUM_DONOR_REGNO=v.HBNUM_DONOR_REGNO and d.gnum_isvalid=1 and v.gnum_isvalid=1 and d.hbstr_mobile_no=? ) and p.HBNUM_DONATION_ID not in (select d.HBSTR_BLDBAG_NO from HBBT_PORTAL_DONATION_DTL d WHERE d.hbstr_mobile_no=? )) UNION (SELECT B.HBDT_DONOR_VISIT_DATE, A.HBSTR_FNAME || ' ' || A.HBSTR_LNAME AS USERNAME, 0 AS FROMPREVDONATIONTABLE, 'NA' AS ORGANIZATIONNAME, 'NA' AS ORGANIZATIONTYPE, (SELECT GSTR_STATE_NAME FROM GBLT_STATE_MST X WHERE X.GNUM_STATE_CODE = A.GNUM_STATE_CODE AND GNUM_ISVALID = 1) AS STATENAME, (SELECT GSTR_DISTRICT_NAME FROM GBLT_DISTRICT_MST X WHERE X.GNUM_DISTRICT_CODE = A.GNUM_DISTRICT_CODE AND GNUM_ISVALID = 1) DISTRICTNAME, NVL(TO_CHAR(HBDT_DONOR_VISIT_DATE, 'dd-Mon-yy'), '-') AS date, (SELECT GSTR_HOSPITAL_NAME FROM GBLT_HOSPITAL_MST M WHERE M.GNUM_HOSPITAL_CODE = A.GNUM_HOSPITAL_CODE) AS BLOODBANK, '':: CHARACTER varying, HBSTR_BLDBAG_NO AS BAGNO, A.GNUM_STATE_CODE AS STATE, A.GNUM_DISTRICT_CODE AS DISTRICT, A.HBSTR_MOBILE_NO, NVL((HBSTR_INITIALBLD_ABO || '' || DECODE(HBNUM_INITIAL_RH, 1, '+ve', 2, '-ve')), (SELECT HBSTR_BLDGRP FROM HBBT_BLDGRP_MST X WHERE X.HBNUM_BLDGRP_CODE = (SELECT HBNUM_BLDGRP_CODE FROM HBBT_PORTAL_DONOR_DTL WHERE HBSTR_MOBILE_NO = ?))) AS BLOODGROUPNAME, HBNUM_DONOR_TYPE_CODE AS DONORTYPE FROM HBBT_DONOR_VISIT_DTL B, HBBT_DONOR_DTL A WHERE B.HBNUM_DONOR_REGNO = A.HBNUM_DONOR_REGNO AND B.GNUM_HOSPITAL_CODE = A.GNUM_HOSPITAL_CODE AND B.HBNUM_DONATION_STATUS IN (2, 3) AND A.HBSTR_MOBILE_NO = ? AND A.GNUM_ISVALID = 1 AND HBSTR_BLDBAG_NO IS NOT NULL ORDER BY HBDT_DONOR_VISIT_DATE DESC) UNION (SELECT DISTINCT GDT_ENTRY_DATE, HBSTR_FNAME AS USERNAME, 0 AS FROMPREVDONATIONTABLE, (SELECT HBSTR_ORGANISATION_NAME FROM HBBT_CAMP_DETAIL WHERE HBNUM_CAMP_REQ_NO = HBNUM_CAMPID AND GNUM_ISVALID = 1 UNION SELECT HBSTR_CONDUCTED_BY FROM HBBT_PORTAL_CAMP_DETAIL WHERE HBNUM_CAMP_REQ_NO = HBNUM_CAMPID AND GNUM_ISVALID = 1 ) AS ORGANIZATIONNAME, NVL( (SELECT HBNUM_ORGANISATION_TYPE_NEW FROM HBBT_CAMP_DETAIL WHERE HBNUM_CAMP_REQ_NO = B.HBNUM_CAMPID AND GNUM_ISVALID = 1 UNION SELECT HBNUM_ORGANISATION_TYPE FROM HBBT_PORTAL_CAMP_DETAIL WHERE HBNUM_CAMP_REQ_NO = B.HBNUM_CAMPID AND GNUM_ISVALID = 1 )::CHARACTER varying ,'NA')AS ORGANIZATIONTYPE, (SELECT GSTR_STATE_NAME FROM GBLT_STATE_MST WHERE GNUM_STATE_CODE IN (SELECT GNUM_STATE_CODE FROM GBLT_PORTAL_HOSPITAL_MST WHERE (GNUM_HOSPITAL_CODE = B.GNUM_HOSPITAL_CODE OR GNUM_ERAKTKOSH_HOSPITAL_CODE = B.GNUM_HOSPITAL_CODE) ) AND GNUM_ISVALID = 1 ) AS STATENAME, (SELECT GSTR_DISTRICT_NAME FROM GBLT_DISTRICT_MST WHERE GNUM_DISTRICT_CODE IN (SELECT NUM_DIST_ID FROM GBLT_PORTAL_HOSPITAL_MST WHERE (GNUM_HOSPITAL_CODE = B.GNUM_HOSPITAL_CODE OR GNUM_ERAKTKOSH_HOSPITAL_CODE = B.GNUM_HOSPITAL_CODE) ) AND GNUM_ISVALID = 1 ) AS DISTRICTNAME, NVL(TO_CHAR(B.HBDT_DONATION_DATE, 'dd-Mon-yy'), '-') AS DATE, (SELECT GSTR_HOSPITAL_NAME FROM GBLT_PORTAL_HOSPITAL_MST WHERE GNUM_HOSPITAL_CODE = B.GNUM_HOSPITAL_CODE AND GNUM_ISVALID = 1 UNION (SELECT GSTR_HOSPITAL_NAME FROM GBLT_PORTAL_HOSPITAL_MST WHERE GNUM_ERAKTKOSH_HOSPITAL_CODE = B.GNUM_HOSPITAL_CODE AND GNUM_ISVALID = 1 )) AS BLOODBANK, B.GNUM_PORTAL_DONOR_ID :: CHARACTER VARYING ,B.HBSTR_BLDBAG_NO AS BAGNO, (SELECT GNUM_STATE_CODE FROM GBLT_PORTAL_HOSPITAL_MST WHERE (GNUM_HOSPITAL_CODE = B.GNUM_HOSPITAL_CODE OR GNUM_ERAKTKOSH_HOSPITAL_CODE = B.GNUM_HOSPITAL_CODE) AND GNUM_ISVALID = 1 ) AS STATE, B.GNUM_DISTRICT_CODE AS DISTRICT, B.HBSTR_MOBILE_NO, (SELECT HBSTR_BLDGRP FROM HBBT_BLDGRP_MST X WHERE B.HBNUM_BLDGRP_CODE = X.HBNUM_BLDGRP_CODE AND GNUM_ISVALID = 1 LIMIT 1) AS BLOODGROUPNAME, HBNUM_DONOR_TYPE AS DONORTYPE FROM HBBT_PORTAL_DONATION_DTL B WHERE B.HBSTR_MOBILE_NO = ? AND B.HBSTR_BLDBAG_NO IS NOT NULL AND B.GNUM_ISVALID = 1 )) ORDER BY GDT_ENTRY_DATE DESC

# QUERY 5....query.SELECT.DONOR_DETAILS
query.CHECK_USERID_EXIST = SELECT COUNT(*) FROM hbbt_portal_donor_dtl WHERE hbstr_userid = ?

# QUERY 6.... fetch otp count
query.GET_OTP_COUNT = SELECT  COUNT (*) FROM hbbt_daily_mobile_otp_count WHERE hbstr_mobileno = ? AND trunc (msg_date) = trunc(sysdate)

# QUERY 7..... insert otp count
query.INSERT.OTP.COUNT = INSERT INTO hbbt_daily_mobile_otp_count (hbstr_mobileno,msg_date) VALUES (?,sysdate);

# Query 8...  insert otp and mobile number generation message.
query.INSERT_OTP_LOG=INSERT INTO hbbt_eraktkosh_log_details VALUES (1, SYSDATE, 1, (SELECT NVL(MAX(hbnum_serial_no), 0) + 1 FROM hbbt_eraktkosh_log_details WHERE gnum_isvalid = 1), ?)

# QUERY 9...
query.SELECT.OTP.TIME = WITH TimeComparison AS (SELECT TO_CHAR(msg_date, 'HH24:MI:SS') AS time_portion, ROW_NUMBER() OVER (ORDER BY msg_date DESC) AS row_num FROM hbbt_daily_mobile_otp_count WHERE hbstr_mobileno = ? AND TRUNC(msg_date) = TRUNC(SYSDATE) ) SELECT time_portion FROM TimeComparison WHERE row_num = 1

# QUERY 10...
query.UPDATE.DONOR.DETAILS = UPDATE hbbt_portal_donor_dtl SET hbstr_fname\=? , hbstr_lname\=? , hbdt_dob\=TO_DATE(?,'dd-mm-yyyy') , gnum_gender_code\=? , hbstr_email_id\=? , hbnum_bldgrp_code\=? , hbstr_father_name\=? , gnum_marital_status_code\=? , hbstr_spouse_name\=? , gnum_occupation_code\=? , gnum_religion_code\=? , hbstr_houesno\=? , hbstr_addr1\=? , hbstr_city_location\=? , hbstr_city\=? , gnum_district_code\=? , gnum_state_code\=? , hbnum_pincode\=? ,  hbstr_landmark\=? WHERE hbstr_userid\=? and hbstr_password\=? and gnum_isvalid\=1

# QUERY 11...
query.SELECT.DONOR_PORTAL_LOGIN_DETAILS = SELECT initcap(hbstr_fname) AS hbstr_fname, hbstr_lname, CASE WHEN hbnum_bldgrp_code = '17' THEN 'AB-pos' WHEN hbnum_bldgrp_code = '18' THEN 'AB-neg'  WHEN hbnum_bldgrp_code = '15' THEN 'O-pos' WHEN hbnum_bldgrp_code = '16' THEN 'O-neg' WHEN hbnum_bldgrp_code = '13' THEN 'B-pos' WHEN hbnum_bldgrp_code = '14' THEN 'B-neg' WHEN hbnum_bldgrp_code = '20' THEN 'A-pos' WHEN hbnum_bldgrp_code = '12' THEN 'A-neg' ELSE NULL END AS hbnum_bldgrp_code, COALESCE(hbdt_lastlogin, CURRENT_DATE) AS hbdt_lastlogin, hbnum_firstlogin, hbnum_demographics, hbnum_usertype, hbstr_mobile_no, gnum_state_code, gnum_district_code, hbnum_pincode, hbstr_email_id, gnum_gender_code, TO_CHAR(hbdt_dob, 'DD-MM-YYYY') AS hbdt_dob, hbstr_addr1, hbstr_father_name, gnum_occupation_code, gnum_religion_code, gnum_marital_status_code, hbstr_spouse_name,  hbstr_city_location, hbstr_city, hbstr_houesno,  hbstr_landmark FROM hbbt_portal_donor_dtl WHERE hbstr_userid = ? AND gnum_isvalid = 1;

# QUERY 12...
query.INSERT.DONOR.DETAILS = insert into hbbt_portal_donor_dtl (hbstr_mobile_no, hbstr_fname, hbstr_lname, hbnum_bldgrp_code, hbstr_password, hbnum_firstlogin, hbnum_demographics, gnum_isvalid, gnum_state_code, gnum_district_code, hbnum_pincode, hbstr_email_id, gnum_gender_code, hbstr_userid, hbstr_addr1, hbnum_allblood, hbnum_repository, hbnum_registration_mode, hbstr_father_name, hbdt_dob, hbdt_reg_date, gdt_entry_date) values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, TO_TIMESTAMP(?, 'YYYY-MM-DD HH24:MI:SS'), sysdate, sysdate);
 
# Query 13... fetch all valid states
fetch.states = SELECT GNUM_STATE_CODE, GSTR_STATE_NAME FROM GBLT_STATE_MST WHERE gstr_country_code='IND' AND GNUM_ISVALID=1 ORDER BY GSTR_STATE_NAME

# Query 14.. fetch all districts on the basis of states...
fetch.districts = select gnum_district_code, gstr_district_name from gblt_district_mst where gnum_isvalid=1 and gnum_state_code=? order by gstr_district_name

# Query 15... fetching gender
fetch.gender = select gstr_gender_code, gstr_gender_name from gblt_gender_mst where gnum_isvalid=1 order by gstr_gender_name

# Query 16... fetching occupation
fetch.occupation = select gnum_occupation_code, gstr_occupation_name from gblt_occupation_mst where gnum_isvalid = 1

# Query 17... fetching marital status
fetch.maritalStatus = select gnum_marital_status_code, gstr_marital_status from gblt_marital_status_mst where gnum_isvalid = 1 order by gstr_marital_status

# Query 18 ... fetching religion
fetch.religion = select gnum_religion_code, gstr_religion_name from gblt_religion_mst where gnum_isvalid = 1 

# Query 19 .. fetch blood group
fetch.bloodGroup = SELECT hbnum_bldgrp_code,hbstr_bldgrp FROM HBBT_BLDGRP_MST where gnum_isvalid = 1

# Query 20 ... fetch Component List...
fetch.componentList = SELECT hbnum_bld_component_id, hbstr_component_name, hbstr_short_name FROM hbbt_bld_component_mst WHERE GNUM_ISVALID=1 AND GNUM_HOSPITAL_CODE=? ORDER BY hbstr_component_name

# Query 21 ... fetch donation camp details...
fetch.blood_donation_camps=SELECT TO_CHAR(DATE(hbdt_camp_date), 'DD-Mon-YYYY') AS campdate, hbstr_camp_starttime || '-' || hbstr_camp_endtime AS camptime, hbstr_camp_name AS campname, hbstr_venue || ',' || DECODE(NVL(TRIM(a.hbstr_venue_address), '0'), '0', '', a.hbstr_venue_address || ', ') || DECODE(NVL(TRIM(a.gstr_camp_add2), '0'), '0', '', a.gstr_camp_add2 || ', ') || DECODE(NVL(TRIM(a.gstr_city), '0'), '0', '', a.gstr_city || ', ') || (SELECT gdm.GSTR_DISTRICT_NAME FROM gblt_district_mst gdm WHERE gdm.GNUM_ISVALID = 1 AND gdm.gnum_district_code = a.num_dist_id) AS campvenue, hbstr_venue_contactno AS contact, INITCAP(hbstr_organisation_name) AS conductedby, pkg_bloodbank_mst.getportalbloodbanknameFromeRaktKosh(gnum_hospital_code::VARCHAR) AS hospName, hbnum_camp_req_no AS camp_reqno, 1 AS type, DECODE(TRUNC(hbdt_camp_date), TRUNC(SYSDATE), 1, hbnum_is_portalregistration) AS is_portalregistration, (SELECT gstr_state_name FROM gblt_state_mst WHERE gnum_state_code = a.gnum_state_code AND gnum_isvalid = 1) AS stateName, (SELECT gdm.GSTR_DISTRICT_NAME FROM gblt_district_mst gdm WHERE gdm.GNUM_ISVALID = 1 AND gdm.gnum_district_code = a.num_dist_id) AS distName, hbdt_camp_date AS dateToSort FROM hbbt_camp_detail a WHERE gnum_isvalid = 1 AND hbnum_req_status = 2 AND gnum_state_code = ? AND (num_dist_id = COALESCE(?, num_dist_id, -1) OR ? = -1) AND hbdt_camp_date = COALESCE(TO_DATE(?, 'YYYY-MM-DD'), TRUNC(SYSDATE)) UNION SELECT TO_CHAR(DATE(hbdt_camp_date), 'DD-Mon-YYYY') AS campdate, hbstr_camp_starttime || '-' || hbstr_camp_endtime AS camptime, hbstr_camp_name AS campname, hbstr_venue_name || ',' || DECODE(NVL(TRIM(a.hbstr_venue_address1), '0'), '0', '', a.hbstr_venue_address1 || ', ') || DECODE(NVL(TRIM(a.hbstr_venue_address2), '0'), '0', '', a.hbstr_venue_address2 || ', ') || DECODE(NVL(TRIM(a.hbstr_venue_city), '0'), '0', '', a.hbstr_venue_city || ', ') || (SELECT gdm.GSTR_DISTRICT_NAME FROM gblt_district_mst gdm WHERE gdm.GNUM_ISVALID = 1 AND gdm.gnum_district_code = a.hbnum_dist_id) AS campvenue, hbstr_venue_contact AS contact, INITCAP(hbstr_organized_by) AS conductedby, pkg_bloodbank_mst.getportalbloodbankname(gnum_portal_hospital_code::VARCHAR) AS hospName, hbnum_camp_req_no AS camp_reqno, 0 AS type, DECODE(TRUNC(hbdt_camp_date), TRUNC(SYSDATE), 1, hbnum_is_portalregistration) AS is_portalregistration, (SELECT gstr_state_name FROM gblt_state_mst WHERE gnum_state_code = a.hbnum_state_code AND gnum_isvalid = 1) AS stateName, (SELECT gdm.GSTR_DISTRICT_NAME FROM gblt_district_mst gdm WHERE gdm.GNUM_ISVALID = 1 AND gdm.gnum_district_code = a.hbnum_dist_id) AS distName, hbdt_camp_date AS dateToSort FROM hbbt_portal_camp_detail a WHERE gnum_isvalid = 1 AND hbnum_state_code = ? AND (hbnum_dist_id = COALESCE(?, hbnum_dist_id, -1) OR ? = -1) AND hbdt_camp_date = COALESCE(TO_DATE(?, 'YYYY-MM-DD'), TRUNC(SYSDATE)) UNION SELECT TO_CHAR(DATE(hbdt_camp_date), 'DD-Mon-YYYY') AS campdate, hbstr_camp_starttime || '-' || hbstr_camp_endtime AS camptime, hbstr_camp_name AS campname, hbstr_venue_name || ',' || DECODE(NVL(TRIM(a.hbstr_venue_address1), '0'), '0', '', a.hbstr_venue_address1 || ', ') || DECODE(NVL(TRIM(a.hbstr_venue_address2), '0'), '0', '', a.hbstr_venue_address2 || ', ') || DECODE(NVL(TRIM(a.hbstr_venue_city), '0'), '0', '', a.hbstr_venue_city || ', ') || (SELECT gdm.GSTR_DISTRICT_NAME FROM gblt_district_mst gdm WHERE gdm.GNUM_ISVALID = 1 AND gdm.gnum_district_code = a.hbnum_dist_id) AS campvenue, hbstr_venue_contact AS contact, INITCAP(hbstr_organized_by) AS conductedby, pkg_bloodbank_mst.getportalbloodbankname(gnum_portal_hospital_code::VARCHAR) AS hospName, hbnum_camp_req_no AS camp_reqno, 0 AS type, hbnum_is_portalregistration AS is_portalregistration, (SELECT gstr_state_name FROM gblt_state_mst WHERE gnum_state_code = a.hbnum_state_code AND gnum_isvalid = 1) AS stateName, (SELECT gdm.GSTR_DISTRICT_NAME FROM gblt_district_mst gdm WHERE gdm.GNUM_ISVALID = 1 AND gdm.gnum_district_code = a.hbnum_dist_id) AS distName, hbdt_camp_date AS dateToSort FROM hbbt_portal_camp_detail_service a WHERE gnum_isvalid = 1 AND hbnum_state_code = ? AND (hbnum_dist_id = COALESCE(?, hbnum_dist_id, -1) OR ? = -1) AND hbdt_camp_date = COALESCE(TO_DATE(?, 'YYYY-MM-DD'), TRUNC(SYSDATE)) ORDER BY dateToSort ASC;

# Query 22 ... fetch nearest bloodbank...
fetch.nearest_blood_bank = SELECT gstr_hospital_name AS name, decode(nvl(trim(a.gstr_hospital_add1), '0'), '0', '', a.gstr_hospital_add1 || ', ') || decode(nvl(trim(a.gstr_hospital_add2), '0'), '0', '', a.gstr_hospital_add2 || ', ') || decode(nvl(trim(a.gstr_city), '0'), '0', '', a.gstr_city || ', ') || 'Dist. ' || (SELECT gdm.GSTR_DISTRICT_NAME FROM gblt_district_mst gdm WHERE gdm.GNUM_ISVALID = 1 AND gdm.gnum_district_code = a.num_dist_id) AS address, count(*) OVER () AS Count, nvl(trim(a.gstr_phone), '') AS phone, nvl(trim(a.gstr_email), '') AS email, (SELECT facilityname FROM (SELECT HJWD.gnum_hospital_code, string_agg(HJWD.hgstr_facility_name, ',' ORDER BY HJWD.hgstr_facility_name) AS facilityname FROM hgbt_hospital_facility_mst hjwd WHERE gnum_isvalid = 1 AND HJWD.gnum_hospital_code = a.gnum_hospital_code GROUP BY HJWD.gnum_hospital_code) AS facilities) AS facility, pkg_bloodbank_mst.getbldbanktype(gnum_hospital_type::VARCHAR) AS hospitalType, gnum_hospital_code AS hospitalCode, hgnum_latitude, hgnum_longitude, gnum_camp_source, gnum_stock_source, a.num_dist_id AS distId, gnum_state_code AS stateCode, decode(hbnum_isbsu, 1, 'BSU', 'Blood Bank') AS type FROM gblt_portal_hospital_mst a WHERE a.GNUM_ISVALID = 1 AND gnum_state_code = ? AND (a.num_dist_id = ? OR ? = -1) ORDER BY gstr_hospital_name;
